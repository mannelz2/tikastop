import{i as l,r as d}from"./utm-helper-C4jEGc4L.js";import{c as m}from"./pix-preloader-tP1izpQF.js";l();const p="https://tbmhixbambsdenkxjdlz.supabase.co",g="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRibWhpeGJhbWJzZGVua3hqZGx6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NzQwMjUsImV4cCI6MjA4MDU1MDAyNX0.C3xXc9utoJFguYXSEHtSEjI4p6Shnx7e3tfmK5o7dP4";let n=null,c=null,i=600;document.addEventListener("DOMContentLoaded",()=>{document.getElementById("copy-button").addEventListener("click",v),u(),y()});async function u(){try{const e=await m("tarifa",3493);if(e.success&&e.qrcode&&e.transactionId)f(e.qrcode,e.transactionId),I(e.transactionId);else throw new Error(e.error||"Erro ao gerar PIX")}catch(e){console.error("Erro:",e),alert("Erro ao gerar pagamento. Tente novamente."),d("pagamento-upsell3.html")}}function f(e,t){const o=document.getElementById("pix-qrcode"),a=document.getElementById("pix-code-input");o.innerHTML="",setTimeout(()=>{try{typeof QRCode<"u"?(new QRCode(o,{text:e,width:250,height:250,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}),console.log("QR Code gerado com sucesso")):(console.error("Biblioteca QRCode não está disponível"),o.innerHTML='<div style="background: #fee2e2; padding: 20px; border-radius: 8px; text-align: center;"><p style="color: #dc2626; font-size: 14px; margin: 0;">QR Code indisponível. Use o código Pix abaixo.</p></div>')}catch(r){console.error("Erro ao gerar QR Code:",r),o.innerHTML='<div style="background: #fee2e2; padding: 20px; border-radius: 8px; text-align: center;"><p style="color: #dc2626; font-size: 14px; margin: 0;">Erro ao gerar QR Code. Use o código Pix abaixo.</p></div>'}},100),a.value=e}function I(e){n&&clearInterval(n),console.log(`[Pagamento Tarifa] Iniciando verificação de pagamento para transação: ${e}`);let t=0;const o=120;n=setInterval(async()=>{if(t++,t>=o){console.log(`[Pagamento Tarifa] Máximo de tentativas (${o}) atingido`),clearInterval(n);return}try{const a=`${p}/functions/v1/check-payment`,r=await fetch(a,{method:"POST",headers:{Authorization:`Bearer ${g}`,"Content-Type":"application/json"},body:JSON.stringify({transactionId:e}),signal:AbortSignal.timeout(1e4)});if(!r.ok)throw new Error("Erro ao verificar pagamento");const s=await r.json();console.log(`[Pagamento Tarifa] Tentativa ${t}/${o} - Status: ${s.status}`),(s.status==="paid"||s.status==="approved")&&(console.log("[Pagamento Tarifa] Pagamento confirmado! Redirecionando..."),clearInterval(n),d("pagamento-upsell4.html"))}catch(a){console.error(`[Pagamento Tarifa] Erro ao verificar pagamento (tentativa ${t}):`,a)}},3e3)}window.addEventListener("beforeunload",()=>{n&&clearInterval(n),c&&clearInterval(c)});document.addEventListener("visibilitychange",()=>{document.hidden?console.log("[Pagamento Tarifa] Página em background - polling continua"):console.log("[Pagamento Tarifa] Página voltou ao foco")});function v(){const e=document.getElementById("pix-code-input"),t=document.getElementById("copy-button");e.select(),document.execCommand("copy"),t.classList.add("copied"),setTimeout(()=>{t.classList.remove("copied")},2e3)}function y(){const e=document.getElementById("timer"),t=document.querySelector(".timer-warning");e&&(c=setInterval(()=>{i--;const o=Math.floor(i/60),a=i%60;e.textContent=`${o}:${a.toString().padStart(2,"0")}`,i<=0&&(clearInterval(c),clearInterval(n),e.textContent="EXPIRADO",t.classList.add("expired"),setTimeout(()=>{alert("O tempo para pagamento expirou. Gerando novo código..."),window.location.reload()},1e3))},1e3))}
